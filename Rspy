local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

local Icons = {
    Home = "rbxassetid://7733960981",
    Settings = "rbxassetid://7734053495", 
    Bolt = "rbxassetid://7733960651",
    Check = "rbxassetid://7733715400",
    Star = "rbxassetid://7733716566"
}

local function CreateTween(object, properties, duration, easingStyle, easingDirection)
    TweenService:Create(object, TweenInfo.new(duration or 0.3, easingStyle or Enum.EasingStyle.Quart, easingDirection or Enum.EasingDirection.Out), properties):Play()
end

local function CreateInstance(className, properties)
    local instance = Instance.new(className)
    for key, value in pairs(properties) do
        if key ~= "Parent" then
            instance[key] = value
        end
    end
    if properties.Parent then
        instance.Parent = properties.Parent
    end
    return instance
end

local function AddCorner(object, radius)
    return CreateInstance("UICorner", {
        CornerRadius = UDim.new(0, radius or 8),
        Parent = object
    })
end

local function AddStroke(object, color, thickness)
    return CreateInstance("UIStroke", {
        Color = color or Color3.fromRGB(80, 120, 200),
        Thickness = thickness or 1,
        Transparency = 0.5,
        Parent = object
    })
end

local MirageUI = {}

function MirageUI:Window(title)
    local WindowAPI = {}
    local ScreenGui = CreateInstance("ScreenGui", {
        Name = "TekkitHub",
        ResetOnSpawn = false,
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
        Parent = PlayerGui
    })

    -- Main Container
    local MainFrame = CreateInstance("Frame", {
        Size = UDim2.new(0, 500, 0, 400),
        Position = UDim2.new(0.5, -250, 0.5, -200),
        BackgroundColor3 = Color3.fromRGB(20, 20, 25),
        Parent = ScreenGui
    })
    AddCorner(MainFrame, 10)
    AddStroke(MainFrame, Color3.fromRGB(60, 60, 80))

    -- Header
    local Header = CreateInstance("Frame", {
        Size = UDim2.new(1, 0, 0, 40),
        BackgroundColor3 = Color3.fromRGB(15, 15, 20),
        Parent = MainFrame
    })
    AddCorner(Header, 10)
    CreateInstance("Frame", {
        Size = UDim2.new(1, 0, 0, 15),
        Position = UDim2.new(0, 0, 1, -15),
        BackgroundColor3 = Color3.fromRGB(15, 15, 20),
        Parent = Header
    })

    CreateInstance("TextLabel", {
        Size = UDim2.new(0, 200, 0, 24),
        Position = UDim2.new(0, 15, 0, 8),
        BackgroundTransparency = 1,
        Text = "TEKKIT HUB",
        TextColor3 = Color3.fromRGB(255, 255, 255),
        TextSize = 18,
        Font = Enum.Font.GothamBold,
        TextXAlignment = Enum.TextXAlignment.Left,
        Parent = Header
    })

    -- Close Button
    local CloseButton = CreateInstance("TextButton", {
        Size = UDim2.new(0, 24, 0, 24),
        Position = UDim2.new(1, -30, 0, 8),
        BackgroundColor3 = Color3.fromRGB(200, 60, 60),
        Text = "",
        Parent = Header
    })
    AddCorner(CloseButton, 6)

    CreateInstance("TextLabel", {
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundTransparency = 1,
        Text = "X",
        TextColor3 = Color3.fromRGB(255, 255, 255),
        TextSize = 14,
        Font = Enum.Font.GothamBold,
        Parent = CloseButton
    })

    CloseButton.MouseButton1Click:Connect(function()
        ScreenGui:Destroy()
    end)

    -- Sidebar
    local Sidebar = CreateInstance("Frame", {
        Size = UDim2.new(0, 120, 1, -50),
        Position = UDim2.new(0, 0, 0, 40),
        BackgroundColor3 = Color3.fromRGB(15, 15, 20),
        Parent = MainFrame
    })
    AddCorner(Sidebar, 10)

    local SidebarLayout = CreateInstance("UIListLayout", {
        Padding = UDim.new(0, 5),
        SortOrder = Enum.SortOrder.LayoutOrder,
        Parent = Sidebar
    })
    CreateInstance("UIPadding", {
        PaddingTop = UDim.new(0, 10),
        PaddingLeft = UDim.new(0, 10),
        Parent = Sidebar
    })

    -- Content Area
    local Content = CreateInstance("ScrollingFrame", {
        Size = UDim2.new(1, -130, 1, -50),
        Position = UDim2.new(0, 120, 0, 40),
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        ScrollBarThickness = 4,
        ScrollBarImageColor3 = Color3.fromRGB(80, 120, 200),
        CanvasSize = UDim2.new(0, 0, 0, 0),
        Parent = MainFrame
    })
    local ContentLayout = CreateInstance("UIListLayout", {
        Padding = UDim.new(0, 8),
        SortOrder = Enum.SortOrder.LayoutOrder,
        Parent = Content
    })
    CreateInstance("UIPadding", {
        PaddingTop = UDim.new(0, 10),
        PaddingLeft = UDim.new(0, 10),
        PaddingRight = UDim.new(0, 10),
        Parent = Content
    })

    ContentLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        Content.CanvasSize = UDim2.new(0, 0, 0, ContentLayout.AbsoluteContentSize.Y + 20)
    end)

    local Groups = {}
    local CurrentGroup = nil

    function WindowAPI:Group(name)
        local GroupAPI = {}
        
        local GroupButton = CreateInstance("TextButton", {
            Size = UDim2.new(1, -20, 0, 35),
            BackgroundColor3 = Color3.fromRGB(25, 25, 35),
            Text = "",
            AutoButtonColor = false,
            LayoutOrder = #Groups + 1,
            Parent = Sidebar
        })
        AddCorner(GroupButton, 6)
        local GroupStroke = AddStroke(GroupButton, Color3.fromRGB(60, 60, 80))

        local GroupLabel = CreateInstance("TextLabel", {
            Size = UDim2.new(1, 0, 1, 0),
            BackgroundTransparency = 1,
            Text = name,
            TextColor3 = Color3.fromRGB(180, 180, 200),
            TextSize = 13,
            Font = Enum.Font.GothamBold,
            Parent = GroupButton
        })

        local GroupContent = CreateInstance("Frame", {
            Size = UDim2.new(1, 0, 0, 0),
            BackgroundTransparency = 1,
            Visible = false,
            Parent = Content
        })
        local GroupContentLayout = CreateInstance("UIListLayout", {
            Padding = UDim.new(0, 8),
            SortOrder = Enum.SortOrder.LayoutOrder,
            Parent = GroupContent
        })

        Groups[name] = {
            button = GroupButton,
            content = GroupContent,
            stroke = GroupStroke,
            label = GroupLabel
        }

        local function SelectGroup()
            GroupButton.BackgroundColor3 = Color3.fromRGB(40, 80, 160)
            GroupStroke.Color = Color3.fromRGB(80, 120, 200)
            GroupLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
            GroupContent.Visible = true
        end

        local function DeselectGroup()
            GroupButton.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
            GroupStroke.Color = Color3.fromRGB(60, 60, 80)
            GroupLabel.TextColor3 = Color3.fromRGB(180, 180, 200)
            GroupContent.Visible = false
        end

        if not CurrentGroup then
            CurrentGroup = name
            SelectGroup()
        end

        GroupButton.MouseButton1Click:Connect(function()
            if CurrentGroup ~= name then
                if CurrentGroup and Groups[CurrentGroup] then
                    Groups[CurrentGroup].content.Visible = false
                    DeselectGroup()
                end
                CurrentGroup = name
                SelectGroup()
            end
        end)

        GroupButton.MouseEnter:Connect(function()
            if CurrentGroup ~= name then
                CreateTween(GroupButton, {BackgroundColor3 = Color3.fromRGB(35, 35, 50)}, 0.2)
            end
        end)

        GroupButton.MouseLeave:Connect(function()
            if CurrentGroup ~= name then
                CreateTween(GroupButton, {BackgroundColor3 = Color3.fromRGB(25, 25, 35)}, 0.2)
            end
        end)

        -- Toggle Element
        function GroupAPI:Toggle(text, default, callback)
            local IsOn = default or false
            
            local Toggle = CreateInstance("Frame", {
                Size = UDim2.new(1, 0, 0, 35),
                BackgroundColor3 = Color3.fromRGB(25, 25, 35),
                Parent = GroupContent
            })
            AddCorner(Toggle, 6)
            AddStroke(Toggle, Color3.fromRGB(60, 60, 80))

            CreateInstance("TextLabel", {
                Size = UDim2.new(1, -60, 1, 0),
                Position = UDim2.new(0, 10, 0, 0),
                BackgroundTransparency = 1,
                Text = text,
                TextColor3 = Color3.fromRGB(220, 220, 255),
                TextSize = 13,
                Font = Enum.Font.Gotham,
                TextXAlignment = Enum.TextXAlignment.Left,
                Parent = Toggle
            })

            local Switch = CreateInstance("Frame", {
                Size = UDim2.new(0, 45, 0, 20),
                Position = UDim2.new(1, -50, 0.5, -10),
                BackgroundColor3 = IsOn and Color3.fromRGB(40, 160, 80) or Color3.fromRGB(60, 60, 80),
                Parent = Toggle
            })
            AddCorner(Switch, 10)

            local Knob = CreateInstance("Frame", {
                Size = UDim2.new(0, 16, 0, 16),
                Position = IsOn and UDim2.new(1, -18, 0.5, -8) or UDim2.new(0, 2, 0.5, -8),
                BackgroundColor3 = Color3.fromRGB(255, 255, 255),
                Parent = Switch
            })
            AddCorner(Knob, 8)

            local ToggleButton = CreateInstance("TextButton", {
                Size = UDim2.new(1, 0, 1, 0),
                BackgroundTransparency = 1,
                Text = "",
                Parent = Toggle
            })

            ToggleButton.MouseButton1Click:Connect(function()
                IsOn = not IsOn
                CreateTween(Switch, {
                    BackgroundColor3 = IsOn and Color3.fromRGB(40, 160, 80) or Color3.fromRGB(60, 60, 80)
                }, 0.2)
                CreateTween(Knob, {
                    Position = IsOn and UDim2.new(1, -18, 0.5, -8) or UDim2.new(0, 2, 0.5, -8)
                }, 0.2)
                if callback then
                    callback(IsOn)
                end
            end)

            return {
                Set = function(value)
                    IsOn = value
                    CreateTween(Switch, {
                        BackgroundColor3 = IsOn and Color3.fromRGB(40, 160, 80) or Color3.fromRGB(60, 60, 80)
                    }, 0.2)
                    CreateTween(Knob, {
                        Position = IsOn and UDim2.new(1, -18, 0.5, -8) or UDim2.new(0, 2, 0.5, -8)
                    }, 0.2)
                end,
                Get = function()
                    return IsOn
                end
            }
        end

        -- Button Element
        function GroupAPI:Button(text, callback)
            local Button = CreateInstance("TextButton", {
                Size = UDim2.new(1, 0, 0, 35),
                BackgroundColor3 = Color3.fromRGB(25, 25, 35),
                Text = "",
                AutoButtonColor = false,
                Parent = GroupContent
            })
            AddCorner(Button, 6)
            local ButtonStroke = AddStroke(Button, Color3.fromRGB(60, 60, 80))

            CreateInstance("TextLabel", {
                Size = UDim2.new(1, 0, 1, 0),
                BackgroundTransparency = 1,
                Text = text,
                TextColor3 = Color3.fromRGB(220, 220, 255),
                TextSize = 13,
                Font = Enum.Font.Gotham,
                Parent = Button
            })

            Button.MouseButton1Click:Connect(function()
                if callback then
                    callback()
                end
                CreateTween(Button, {BackgroundColor3 = Color3.fromRGB(40, 80, 160)}, 0.1)
                task.delay(0.1, function()
                    CreateTween(Button, {BackgroundColor3 = Color3.fromRGB(25, 25, 35)}, 0.2)
                end)
            end)

            Button.MouseEnter:Connect(function()
                CreateTween(Button, {BackgroundColor3 = Color3.fromRGB(35, 35, 50)}, 0.2)
            end)

            Button.MouseLeave:Connect(function()
                CreateTween(Button, {BackgroundColor3 = Color3.fromRGB(25, 25, 35)}, 0.2)
            end)

            return Button
        end

        -- Slider Element
        function GroupAPI:Slider(text, min, max, default, callback)
            local Value = default or min
            
            local Slider = CreateInstance("Frame", {
                Size = UDim2.new(1, 0, 0, 50),
                BackgroundColor3 = Color3.fromRGB(25, 25, 35),
                Parent = GroupContent
            })
            AddCorner(Slider, 6)
            AddStroke(Slider, Color3.fromRGB(60, 60, 80))

            CreateInstance("TextLabel", {
                Size = UDim2.new(1, -60, 0, 20),
                Position = UDim2.new(0, 10, 0, 5),
                BackgroundTransparency = 1,
                Text = text .. ": " .. Value,
                TextColor3 = Color3.fromRGB(220, 220, 255),
                TextSize = 13,
                Font = Enum.Font.Gotham,
                TextXAlignment = Enum.TextXAlignment.Left,
                Parent = Slider
            })

            local SliderBar = CreateInstance("Frame", {
                Size = UDim2.new(1, -20, 0, 6),
                Position = UDim2.new(0, 10, 1, -15),
                BackgroundColor3 = Color3.fromRGB(40, 40, 50),
                Parent = Slider
            })
            AddCorner(SliderBar, 3)

            local SliderFill = CreateInstance("Frame", {
                Size = UDim2.new((Value - min) / (max - min), 0, 1, 0),
                BackgroundColor3 = Color3.fromRGB(40, 160, 80),
                Parent = SliderBar
            })
            AddCorner(SliderFill, 3)

            local ValueBox = CreateInstance("TextLabel", {
                Size = UDim2.new(0, 40, 0, 20),
                Position = UDim2.new(1, -45, 0, 5),
                BackgroundColor3 = Color3.fromRGB(40, 40, 50),
                Text = tostring(Value),
                TextColor3 = Color3.fromRGB(220, 220, 255),
                TextSize = 12,
                Font = Enum.Font.GothamBold,
                Parent = Slider
            })
            AddCorner(ValueBox, 4)

            local IsDragging = false

            local function UpdateSlider(input)
                local barX = SliderBar.AbsolutePosition.X
                local barWidth = SliderBar.AbsoluteSize.X
                local percentage = math.clamp((input.Position.X - barX) / barWidth, 0, 1)
                Value = math.floor(min + (max - min) * percentage)
                ValueBox.Text = tostring(Value)
                CreateTween(SliderFill, {Size = UDim2.new(percentage, 0, 1, 0)}, 0.1)
                if callback then
                    callback(Value)
                end
            end

            local SliderButton = CreateInstance("TextButton", {
                Size = UDim2.new(1, 0, 1, 0),
                BackgroundTransparency = 1,
                Text = "",
                ZIndex = 10,
                Parent = Slider
            })

            SliderButton.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    IsDragging = true
                    UpdateSlider(input)
                end
            end)

            UserInputService.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    IsDragging = false
                end
            end)

            UserInputService.InputChanged:Connect(function(input)
                if IsDragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                    UpdateSlider(input)
                end
            end)

            return {
                Set = function(value)
                    Value = value
                    ValueBox.Text = tostring(value)
                    local percentage = (value - min) / (max - min)
                    CreateTween(SliderFill, {Size = UDim2.new(percentage, 0, 1, 0)}, 0.2)
                end,
                Get = function()
                    return Value
                end
            }
        end

        -- Label Element
        function GroupAPI:Label(text)
            local Label = CreateInstance("TextLabel", {
                Size = UDim2.new(1, 0, 0, 25),
                BackgroundTransparency = 1,
                Text = text,
                TextColor3 = Color3.fromRGB(150, 150, 170),
                TextSize = 12,
                Font = Enum.Font.GothamBold,
                TextXAlignment = Enum.TextXAlignment.Left,
                Parent = GroupContent
            })
            return Label
        end

        return GroupAPI
    end

    function WindowAPI:Destroy()
        ScreenGui:Destroy()
    end

    return WindowAPI
end

return MirageUI

local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")

-- Unified icon system
local Icons = {
    Home = "rbxassetid://7733960981"
}

-- Simplified tween helper
local function Tween(object, properties, duration, easingStyle, easingDirection)
    TweenService:Create(object, TweenInfo.new(duration or 0.3, easingStyle or Enum.EasingStyle.Quart, easingDirection or Enum.EasingDirection.Out), properties):Play()
end

-- Instance creator
local function Create(className, props)
    local instance = Instance.new(className)
    for k, v in pairs(props) do
        if k ~= "Parent" then instance[k] = v end
    end
    if props.Parent then instance.Parent = props.Parent end
    return instance
end

-- Decorative helpers
local function AddCorner(object, radius) return Create("UICorner", {CornerRadius = UDim.new(0, radius or 8), Parent = object}) end
local function AddStroke(object, color, thickness) return Create("UIStroke", {Color = color or Color3.fromRGB(80, 120, 200), Thickness = thickness or 1, Transparency = 0.6, Parent = object}) end
local function AddGlow(object, color, size) 
    return Create("ImageLabel", {
        Size = UDim2.new(1, size or 20, 1, size or 20),
        Position = UDim2.new(0.5, -(size or 20)/2, 0.5, -(size or 20)/2),
        BackgroundTransparency = 1,
        Image = "rbxassetid://5028857084",
        ImageColor3 = color or Color3.fromRGB(100, 150, 255),
        ImageTransparency = 0.85,
        ZIndex = object.ZIndex - 1,
        Parent = object
    })
end

-- Notification system
local ActiveNotifications = {}

local function UpdateNotificationPositions()
    for index, notification in ipairs(ActiveNotifications) do
        Tween(notification, {Position = UDim2.new(1, -320, 1, -24 - (index * 77))}, 0.25, Enum.EasingStyle.Quart)
    end
end

local MirageUI = {}

function MirageUI:Notify(title, content, duration, iconType)
    local notificationScreen = CoreGui:FindFirstChild("MirageNotify") or Create("ScreenGui", {
        Name = "MirageNotify",
        ResetOnSpawn = false,
        Parent = CoreGui
    })
    
    local notification = Create("Frame", {
        Size = UDim2.new(0, 295, 0, 68),
        Position = UDim2.new(1, 320, 1, -90),
        BackgroundColor3 = Color3.fromRGB(16, 18, 24),
        Parent = notificationScreen
    })
    AddCorner(notification, 12)
    local stroke = AddStroke(notification, Color3.fromRGB(100, 150, 255), 1.5)
    local glow = AddGlow(notification, Color3.fromRGB(100, 150, 255), 32)
    
    table.insert(ActiveNotifications, notification)
    UpdateNotificationPositions()
    
    Create("ImageLabel", {
        Size = UDim2.new(0, 22, 0, 22),
        Position = UDim2.new(0, 14, 0, 14),
        BackgroundTransparency = 1,
        Image = Icons.Home,
        ImageColor3 = Color3.fromRGB(100, 150, 255),
        Parent = notification
    })
    
    Create("TextLabel", {
        Size = UDim2.new(1, -54, 0, 18),
        Position = UDim2.new(0, 42, 0, 12),
        BackgroundTransparency = 1,
        Text = title or "Notice",
        TextColor3 = Color3.fromRGB(240, 245, 255),
        TextSize = 13,
        Font = Enum.Font.GothamBold,
        TextXAlignment = Enum.TextXAlignment.Left,
        Parent = notification
    })
    
    Create("TextLabel", {
        Size = UDim2.new(1, -54, 0, 15),
        Position = UDim2.new(0, 42, 0, 32),
        BackgroundTransparency = 1,
        Text = content or "",
        TextColor3 = Color3.fromRGB(150, 160, 190),
        TextSize = 11,
        Font = Enum.Font.Gotham,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextWrapped = true,
        Parent = notification
    })
    
    local progress = Create("Frame", {
        Size = UDim2.new(1, -20, 0, 3),
        Position = UDim2.new(0, 10, 1, -9),
        BackgroundColor3 = Color3.fromRGB(30, 34, 42),
        Parent = notification
    })
    AddCorner(progress, 2)
    
    local fill = Create("Frame", {
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundColor3 = Color3.fromRGB(100, 150, 255),
        Parent = progress
    })
    AddCorner(fill, 2)
    
    Tween(glow, {ImageTransparency = 0.72}, 0.4)
    
    task.spawn(function()
        local displayTime = duration or 3.5
        for i = 100, 0, -1.5 do
            fill.Size = UDim2.new(i/100, 0, 1, 0)
            task.wait(displayTime / 67)
        end
        
        Tween(notification, {Position = UDim2.new(1, 320, notification.Position.Y.Scale, notification.Position.Y.Offset)}, 0.35)
        Tween(stroke, {Transparency = 1}, 0.3)
        Tween(glow, {ImageTransparency = 1}, 0.3)
        
        task.wait(0.35)
        for i, notif in ipairs(ActiveNotifications) do
            if notif == notification then
                table.remove(ActiveNotifications, i)
                break
            end
        end
        notification:Destroy()
        UpdateNotificationPositions()
    end)
    
    return notification
end

function MirageUI:Window(title)
    local WindowAPI = {}
    local ScreenGui = Create("ScreenGui", {
        Name = "MirageUI",
        ResetOnSpawn = false,
        Parent = CoreGui
    })
    
    -- Toggle button
    local ToggleButton = Create("ImageButton", {
        Size = UDim2.new(0, 44, 0, 44),
        Position = UDim2.new(0, 20, 0.5, -22),
        BackgroundColor3 = Color3.fromRGB(16, 18, 24),
        Parent = ScreenGui
    })
    AddCorner(ToggleButton, 10)
    local ToggleStroke = AddStroke(ToggleButton, Color3.fromRGB(100, 150, 255), 1.5)
    local ToggleGlow = AddGlow(ToggleButton, Color3.fromRGB(100, 150, 255), 28)
    
    local ToggleIcon = Create("ImageLabel", {
        Size = UDim2.new(0, 20, 0, 20),
        Position = UDim2.new(0.5, -10, 0.5, -10),
        BackgroundTransparency = 1,
        Image = Icons.Home,
        ImageColor3 = Color3.fromRGB(100, 150, 255),
        Parent = ToggleButton
    })
    
    -- Gentle rotation
    task.spawn(function()
        while task.wait(0.04) do
            if ToggleIcon and ToggleIcon.Parent then
                ToggleIcon.Rotation = (ToggleIcon.Rotation + 0.8) % 360
            end
        end
    end)
    
    -- Main window
    local MainFrame = Create("Frame", {
        Size = UDim2.new(0, 0, 0, 0),
        Position = UDim2.new(0.5, 0, 0.5, 0),
        AnchorPoint = Vector2.new(0.5, 0.5),
        BackgroundColor3 = Color3.fromRGB(13, 15, 21),
        Visible = false,
        ClipsDescendants = true,
        Parent = ScreenGui
    })
    AddCorner(MainFrame, 14)
    local MainStroke = AddStroke(MainFrame, Color3.fromRGB(80, 120, 200), 1.5)
    local MainGlow = AddGlow(MainFrame, Color3.fromRGB(70, 110, 190), 45)
    
    -- Header
    local Header = Create("Frame", {
        Size = UDim2.new(1, 0, 0, 52),
        BackgroundColor3 = Color3.fromRGB(9, 11, 16),
        Parent = MainFrame
    })
    AddCorner(Header, 14)
    Create("Frame", {
        Size = UDim2.new(1, 0, 0, 16),
        Position = UDim2.new(0, 0, 1, -16),
        BackgroundColor3 = Color3.fromRGB(9, 11, 16),
        Parent = Header
    })
    
    local HeaderLine = Create("Frame", {
        Size = UDim2.new(1, 0, 0, 2),
        Position = UDim2.new(0, 0, 1, 0),
        BackgroundColor3 = Color3.fromRGB(100, 150, 255),
        Parent = Header
    })
    local HeaderGradient = Create("UIGradient", {
        Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0, Color3.fromRGB(100, 150, 255)),
            ColorSequenceKeypoint.new(0.5, Color3.fromRGB(150, 100, 255)),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(100, 150, 255))
        }),
        Parent = HeaderLine
    })
    
    -- Smooth gradient animation
    task.spawn(function()
        while task.wait(0.03) do
            if HeaderGradient then
                HeaderGradient.Offset = Vector2.new((HeaderGradient.Offset.X + 0.008) % 2 - 1, 0)
            end
        end
    end)
    
    -- Logo
    local Logo = Create("Frame", {
        Size = UDim2.new(0, 30, 0, 30),
        Position = UDim2.new(0, 12, 0, 11),
        BackgroundColor3 = Color3.fromRGB(100, 150, 255),
        Parent = Header
    })
    AddCorner(Logo, 7)
    Create("UIGradient", {
        Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0, Color3.fromRGB(100, 150, 255)),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(150, 100, 255))
        }),
        Rotation = 45,
        Parent = Logo
    })
    Create("ImageLabel", {
        Size = UDim2.new(0, 16, 0, 16),
        Position = UDim2.new(0.5, -8, 0.5, -8),
        BackgroundTransparency = 1,
        Image = Icons.Home,
        ImageColor3 = Color3.fromRGB(255, 255, 255),
        Parent = Logo
    })
    
    Create("TextLabel", {
        Size = UDim2.new(0, 200, 0, 18),
        Position = UDim2.new(0, 50, 0, 9),
        BackgroundTransparency = 1,
        Text = title or "Mirage UI",
        TextColor3 = Color3.fromRGB(255, 255, 255),
        TextSize = 15,
        Font = Enum.Font.GothamBold,
        TextXAlignment = Enum.TextXAlignment.Left,
        Parent = Header
    })
    
    local Subtitle = Create("TextLabel", {
        Size = UDim2.new(0, 200, 0, 12),
        Position = UDim2.new(0, 50, 0, 29),
        BackgroundTransparency = 1,
        Text = "v2.0 â€¢ Human Edition",
        TextColor3 = Color3.fromRGB(110, 125, 165),
        TextSize = 9,
        Font = Enum.Font.GothamMedium,
        TextXAlignment = Enum.TextXAlignment.Left,
        Parent = Header
    })
    
    -- Search
    local SearchBox = Create("Frame", {
        Size = UDim2.new(0, 165, 0, 28),
        Position = UDim2.new(1, -175, 0, 12),
        BackgroundColor3 = Color3.fromRGB(15, 17, 23),
        Parent = Header
    })
    AddCorner(SearchBox, 7)
    local SearchStroke = AddStroke(SearchBox, Color3.fromRGB(60, 80, 120))
    
    Create("ImageLabel", {
        Size = UDim2.new(0, 13, 0, 13),
        Position = UDim2.new(0, 9, 0.5, -6.5),
        BackgroundTransparency = 1,
        Image = Icons.Home,
        ImageColor3 = Color3.fromRGB(115, 130, 170),
        Parent = SearchBox
    })
    
    local SearchInput = Create("TextBox", {
        Size = UDim2.new(1, -32, 1, 0),
        Position = UDim2.new(0, 26, 0, 0),
        BackgroundTransparency = 1,
        Text = "",
        PlaceholderText = "Search features...",
        TextColor3 = Color3.fromRGB(220, 225, 255),
        PlaceholderColor3 = Color3.fromRGB(85, 95, 130),
        TextSize = 11,
        Font = Enum.Font.Gotham,
        TextXAlignment = Enum.TextXAlignment.Left,
        ClearTextOnFocus = false,
        Parent = SearchBox
    })
    
    -- Close button
    local CloseButton = Create("TextButton", {
        Size = UDim2.new(0, 28, 0, 28),
        Position = UDim2.new(1, -38, 0, 12),
        BackgroundColor3 = Color3.fromRGB(20, 24, 32),
        Text = "",
        Parent = Header
    })
    AddCorner(CloseButton, 7)
    local CloseStroke = AddStroke(CloseButton, Color3.fromRGB(50, 60, 80))
    
    local CloseIcon = Create("ImageLabel", {
        Size = UDim2.new(0, 13, 0, 13),
        Position = UDim2.new(0.5, -6.5, 0.5, -6.5),
        BackgroundTransparency = 1,
        Image = Icons.Home,
        ImageColor3 = Color3.fromRGB(200, 110, 110),
        Parent = CloseButton
    })
    
    -- Content areas
    local TabsContainer = Create("Frame", {
        Size = UDim2.new(0, 135, 1, -64),
        Position = UDim2.new(0, 8, 0, 58),
        BackgroundColor3 = Color3.fromRGB(16, 19, 26),
        Parent = MainFrame
    })
    AddCorner(TabsContainer, 10)
    Create("UIPadding", {PaddingTop = UDim.new(0, 6), Parent = TabsContainer})
    Create("UIListLayout", {Padding = UDim.new(0, 5), SortOrder = Enum.SortOrder.LayoutOrder, Parent = TabsContainer})
    
    local ContentScroll = Create("ScrollingFrame", {
        Size = UDim2.new(1, -152, 1, -64),
        Position = UDim2.new(0, 148, 0, 58),
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        ScrollBarThickness = 4,
        ScrollBarImageColor3 = Color3.fromRGB(80, 120, 200),
        Parent = MainFrame
    })
    Create("UIPadding", {PaddingTop = UDim.new(0, 5), PaddingRight = UDim.new(0, 8), Parent = ContentScroll})
    local ContentLayout = Create("UIListLayout", {Padding = UDim.new(0, 7), SortOrder = Enum.SortOrder.LayoutOrder, Parent = ContentScroll})
    
    ContentLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        ContentScroll.CanvasSize = UDim2.new(0, 0, 0, ContentLayout.AbsoluteContentSize.Y + 12)
    end)
    
    -- State
    local IsOpen = false
    local CurrentTab = nil
    local TabData = {}
    local AllElements = {}
    
    -- Window controls
    local function OpenWindow()
        MainFrame.Visible = true
        MainFrame.Size = UDim2.new(0, 0, 0, 0)
        Tween(MainFrame, {Size = UDim2.new(0, 590, 0, 430)}, 0.45, Enum.EasingStyle.Back)
        Tween(MainStroke, {Transparency = 0.35}, 0.4)
        Tween(MainGlow, {ImageTransparency = 0.78}, 0.5)
        Tween(ToggleButton, {Rotation = 180}, 0.4)
        Tween(ToggleStroke, {Thickness = 2.5, Transparency = 0}, 0.3)
        self:Notify("Mirage UI", "Interface opened", 2)
    end
    
    local function CloseWindow()
        Tween(MainFrame, {Size = UDim2.new(0, 0, 0, 0)}, 0.35, Enum.EasingStyle.Quart, Enum.EasingDirection.In)
        Tween(MainStroke, {Transparency = 1}, 0.3)
        Tween(MainGlow, {ImageTransparency = 1}, 0.3)
        Tween(ToggleButton, {Rotation = 0}, 0.4)
        Tween(ToggleStroke, {Thickness = 1.5, Transparency = 0.6}, 0.3)
        task.delay(0.35, function() MainFrame.Visible = false end)
    end
    
    ToggleButton.MouseButton1Click:Connect(function()
        IsOpen = not IsOpen
        IsOpen and OpenWindow() or CloseWindow()
    end)
    
    CloseButton.MouseButton1Click:Connect(function()
        IsOpen = false
        CloseWindow()
    end)
    
    -- Hover effects
    ToggleButton.MouseEnter:Connect(function()
        Tween(ToggleButton, {Size = UDim2.new(0, 46, 0, 46)}, 0.25, Enum.EasingStyle.Back)
        Tween(ToggleStroke, {Transparency = 0.25}, 0.2)
        Tween(ToggleGlow, {ImageTransparency = 0.6, Size = UDim2.new(1, 36, 1, 36)}, 0.25)
    end)
    
    ToggleButton.MouseLeave:Connect(function()
        Tween(ToggleButton, {Size = UDim2.new(0, 44, 0, 44)}, 0.25, Enum.EasingStyle.Back)
        Tween(ToggleStroke, {Transparency = IsOpen and 0 or 0.6}, 0.2)
        Tween(ToggleGlow, {ImageTransparency = 0.85, Size = UDim2.new(1, 28, 1, 28)}, 0.25)
    end)
    
    CloseButton.MouseEnter:Connect(function()
        Tween(CloseButton, {BackgroundColor3 = Color3.fromRGB(60, 30, 30), Size = UDim2.new(0, 30, 0, 30)}, 0.2)
        Tween(CloseStroke, {Color = Color3.fromRGB(255, 100, 100)}, 0.2)
        Tween(CloseIcon, {Rotation = 90}, 0.3)
    end)
    
    CloseButton.MouseLeave:Connect(function()
        Tween(CloseButton, {BackgroundColor3 = Color3.fromRGB(20, 24, 32), Size = UDim2.new(0, 28, 0, 28)}, 0.2)
        Tween(CloseStroke, {Color = Color3.fromRGB(50, 60, 80)}, 0.2)
        Tween(CloseIcon, {Rotation = 0}, 0.3)
    end)
    
    -- Dragging
    local Dragging, DragInput, DragStart, StartPos = false
    
    Header.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            Dragging = true
            DragStart = input.Position
            StartPos = MainFrame.Position
            input.Changed:Connect(function() if input.UserInputState == Enum.UserInputState.End then Dragging = false end end)
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if input == DragInput and Dragging then
            local delta = input.Position - DragStart
            MainFrame.Position = UDim2.new(StartPos.X.Scale, StartPos.X.Offset + delta.X, StartPos.Y.Scale, StartPos.Y.Offset + delta.Y)
        end
    end)
    
    Header.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then DragInput = input end
    end)
    
    -- Search
    SearchInput.Focused:Connect(function()
        Tween(SearchStroke, {Color = Color3.fromRGB(100, 150, 255), Transparency = 0.25}, 0.2)
        Tween(SearchBox, {BackgroundColor3 = Color3.fromRGB(22, 26, 34)}, 0.2)
    end)
    
    SearchInput.FocusLost:Connect(function()
        Tween(SearchStroke, {Color = Color3.fromRGB(60, 80, 120), Transparency = 0.55}, 0.2)
        Tween(SearchBox, {BackgroundColor3 = Color3.fromRGB(15, 17, 23)}, 0.2)
    end)
    
    SearchInput:GetPropertyChangedSignal("Text"):Connect(function()
        local query = SearchInput.Text:lower()
        for _, element in pairs(AllElements) do
            element.frame.Visible = query == "" and (element.tab == CurrentTab) or element.name:lower():find(query, 1, true) ~= nil
        end
    end)
    
    -- Tab creation
    function WindowAPI:Tab(name, icon)
        local TabAPI = {}
        
        local TabButton = Create("TextButton", {
            Size = UDim2.new(1, -10, 0, 36),
            BackgroundColor3 = Color3.fromRGB(21, 25, 33),
            Text = "",
            AutoButtonColor = false,
            Parent = TabsContainer
        })
        AddCorner(TabButton, 7)
        local TabStroke = AddStroke(TabButton, Color3.fromRGB(40, 50, 70))
        
        local TabIcon = Create("ImageLabel", {
            Size = UDim2.new(0, 16, 0, 16),
            Position = UDim2.new(0, 12, 0.5, -8),
            BackgroundTransparency = 1,
            Image = Icons.Home,
            ImageColor3 = Color3.fromRGB(140, 160, 200),
            Parent = TabButton
        })
        
        local TabName = Create("TextLabel", {
            Size = UDim2.new(1, -38, 1, 0),
            Position = UDim2.new(0, 34, 0, 0),
            BackgroundTransparency = 1,
            Text = name or "Tab",
            TextColor3 = Color3.fromRGB(180, 190, 220),
            TextSize = 12,
            Font = Enum.Font.GothamBold,
            TextXAlignment = Enum.TextXAlignment.Left,
            Parent = TabButton
        })
        
        local TabIndicator = Create("Frame", {
            Size = UDim2.new(0, 0, 0, 0),
            Position = UDim2.new(0, 0, 0.5, 0),
            AnchorPoint = Vector2.new(0, 0.5),
            BackgroundColor3 = Color3.fromRGB(100, 150, 255),
            Parent = TabButton
        })
        AddCorner(TabIndicator, 2)
        
        local TabContent = Create("Frame", {
            Size = UDim2.new(1, 0, 1, 0),
            BackgroundTransparency = 1,
            Visible = false,
            Parent = ContentScroll
        })
        Create("UIListLayout", {Padding = UDim.new(0, 7), SortOrder = Enum.SortOrder.LayoutOrder, Parent = TabContent})
        
        TabData[name] = {
            button = TabButton,
            content = TabContent,
            stroke = TabStroke,
            label = TabName,
            icon = TabIcon,
            indicator = TabIndicator
        }
        
        if not CurrentTab then
            CurrentTab = name
            TabContent.Visible = true
            TabButton.BackgroundColor3 = Color3.fromRGB(80, 120, 200)
            TabStroke.Color = Color3.fromRGB(100, 150, 255)
            TabStroke.Transparency = 0.3
            TabName.TextColor3 = Color3.fromRGB(255, 255, 255)
            TabIcon.ImageColor3 = Color3.fromRGB(255, 255, 255)
            Tween(TabIndicator, {Size = UDim2.new(0, 3, 0.65, 0)}, 0.3, Enum.EasingStyle.Back)
        end
        
        TabButton.MouseButton1Click:Connect(function()
            if CurrentTab ~= name then
                if CurrentTab and TabData[CurrentTab] then
                    TabData[CurrentTab].content.Visible = false
                    local old = TabData[CurrentTab]
                    Tween(old.button, {BackgroundColor3 = Color3.fromRGB(21, 25, 33)}, 0.2)
                    Tween(old.stroke, {Color = Color3.fromRGB(40, 50, 70), Transparency = 0.5}, 0.2)
                    Tween(old.label, {TextColor3 = Color3.fromRGB(180, 190, 220)}, 0.2)
                    Tween(old.icon, {ImageColor3 = Color3.fromRGB(140, 160, 200)}, 0.2)
                    Tween(old.indicator, {Size = UDim2.new(0, 0, 0, 0)}, 0.2)
                end
                CurrentTab = name
                TabContent.Visible = true
                Tween(TabButton, {BackgroundColor3 = Color3.fromRGB(80, 120, 200)}, 0.2)
                Tween(TabStroke, {Color = Color3.fromRGB(100, 150, 255), Transparency = 0.3}, 0.2)
                Tween(TabName, {TextColor3 = Color3.fromRGB(255, 255, 255)}, 0.2)
                Tween(TabIcon, {ImageColor3 = Color3.fromRGB(255, 255, 255), Rotation = 360}, 0.4)
                Tween(TabIndicator, {Size = UDim2.new(0, 3, 0.65, 0)}, 0.3, Enum.EasingStyle.Back)
                task.delay(0.4, function() TabIcon.Rotation = 0 end)
                ContentScroll.CanvasPosition = Vector2.new(0, 0)
                SearchInput.Text = ""
                for _, element in pairs(AllElements) do
                    element.frame.Visible = (element.tab == name)
                end
            end
        end)
        
        TabButton.MouseEnter:Connect(function()
            if CurrentTab ~= name then
                Tween(TabButton, {BackgroundColor3 = Color3.fromRGB(30, 36, 48)}, 0.15)
                Tween(TabStroke, {Color = Color3.fromRGB(60, 80, 120)}, 0.15)
                Tween(TabIndicator, {Size = UDim2.new(0, 3, 0.3, 0)}, 0.15)
            end
        end)
        
        TabButton.MouseLeave:Connect(function()
            if CurrentTab ~= name then
                Tween(TabButton, {BackgroundColor3 = Color3.fromRGB(21, 25, 33)}, 0.15)
                Tween(TabStroke, {Color = Color3.fromRGB(40, 50, 70)}, 0.15)
                Tween(TabIndicator, {Size = UDim2.new(0, 0, 0, 0)}, 0.15)
            end
        end)
        
        -- Elements
        function TabAPI:Button(text, callback)
            local Button = Create("TextButton", {
                Size = UDim2.new(1, -8, 0, 40),
                BackgroundColor3 = Color3.fromRGB(21, 25, 33),
                Text = "",
                AutoButtonColor = false,
                Parent = TabContent
            })
            AddCorner(Button, 8)
            local ButtonStroke = AddStroke(Button, Color3.fromRGB(50, 60, 80))
            local ButtonGlow = AddGlow(Button, Color3.fromRGB(80, 120, 200), 18)
            
            Create("ImageLabel", {
                Size = UDim2.new(0, 18, 0, 18),
                Position = UDim2.new(0, 12, 0.5, -9),
                BackgroundTransparency = 1,
                Image = Icons.Home,
                ImageColor3 = Color3.fromRGB(100, 150, 255),
                Parent = Button
            })
            
            Create("TextLabel", {
                Size = UDim2.new(1, -50, 1, 0),
                Position = UDim2.new(0, 38, 0, 0),
                BackgroundTransparency = 1,
                Text = text or "Button",
                TextColor3 = Color3.fromRGB(220, 230, 255),
                TextSize = 12,
                Font = Enum.Font.GothamBold,
                TextXAlignment = Enum.TextXAlignment.Left,
                Parent = Button
            })
            
            local Arrow = Create("ImageLabel", {
                Size = UDim2.new(0, 12, 0, 12),
                Position = UDim2.new(1, -26, 0.5, -6),
                BackgroundTransparency = 1,
                Image = Icons.Home,
                ImageColor3 = Color3.fromRGB(80, 100, 140),
                Rotation = -90,
                Parent = Button
            })
            
            table.insert(AllElements, {frame = Button, name = text or "Button", tab = name})
            
            Button.MouseButton1Click:Connect(function()
                callback and callback()
                Tween(Button, {BackgroundColor3 = Color3.fromRGB(100, 150, 255)}, 0.08)
                Tween(ButtonGlow, {ImageTransparency = 0.65}, 0.08)
                task.delay(0.08, function()
                    Tween(Button, {BackgroundColor3 = Color3.fromRGB(21, 25, 33)}, 0.25)
                    Tween(ButtonGlow, {ImageTransparency = 0.85}, 0.25)
                end)
            end)
            
            Button.MouseEnter:Connect(function()
                Tween(Button, {BackgroundColor3 = Color3.fromRGB(30, 36, 48)}, 0.2)
                Tween(ButtonStroke, {Color = Color3.fromRGB(80, 120, 200), Transparency = 0.35}, 0.2)
                Tween(Arrow, {Position = UDim2.new(1, -22, 0.5, -6)}, 0.2)
                Tween(ButtonGlow, {ImageTransparency = 0.75}, 0.2)
            end)
            
            Button.MouseLeave:Connect(function()
                Tween(Button, {BackgroundColor3 = Color3.fromRGB(21, 25, 33)}, 0.2)
                Tween(ButtonStroke, {Color = Color3.fromRGB(50, 60, 80), Transparency = 0.55}, 0.2)
                Tween(Arrow, {Position = UDim2.new(1, -26, 0.5, -6)}, 0.2)
                Tween(ButtonGlow, {ImageTransparency = 0.85}, 0.2)
            end)
            
            return Button
        end
        
        function TabAPI:Toggle(text, default, callback)
            local IsOn = default or false
            
            local Toggle = Create("Frame", {
                Size = UDim2.new(1, -8, 0, 40),
                BackgroundColor3 = Color3.fromRGB(21, 25, 33),
                Parent = TabContent
            })
            AddCorner(Toggle, 8)
            local ToggleStroke = AddStroke(Toggle, IsOn and Color3.fromRGB(100, 150, 255) or Color3.fromRGB(50, 60, 80))
            ToggleStroke.Transparency = IsOn and 0.35 or 0.55
            
            local ToggleGlow = AddGlow(Toggle, Color3.fromRGB(80, 120, 200), 18)
            ToggleGlow.ImageTransparency = IsOn and 0.8 or 0.85
            
            Create("ImageLabel", {
                Size = UDim2.new(0, 18, 0, 18),
                Position = UDim2.new(0, 12, 0.5, -9),
                BackgroundTransparency = 1,
                Image = Icons.Home,
                ImageColor3 = Color3.fromRGB(100, 150, 255),
                Parent = Toggle
            })
            
            Create("TextLabel", {
                Size = UDim2.new(1, -100, 1, 0),
                Position = UDim2.new(0, 38, 0, 0),
                BackgroundTransparency = 1,
                Text = text or "Toggle",
                TextColor3 = Color3.fromRGB(220, 230, 255),
                TextSize = 12,
                Font = Enum.Font.GothamBold,
                TextXAlignment = Enum.TextXAlignment.Left,
                Parent = Toggle
            })
            
            local Switch = Create("Frame", {
                Size = UDim2.new(0, 48, 0, 24),
                Position = UDim2.new(1, -58, 0.5, -12),
                BackgroundColor3 = IsOn and Color3.fromRGB(80, 120, 200) or Color3.fromRGB(35, 40, 50),
                Parent = Toggle
            })
            AddCorner(Switch, 12)
            
            local Knob = Create("Frame", {
                Size = UDim2.new(0, 20, 0, 20),
                Position = IsOn and UDim2.new(1, -22, 0.5, -10) or UDim2.new(0, 2, 0.5, -10),
                BackgroundColor3 = Color3.fromRGB(255, 255, 255),
                Parent = Switch
            })
            AddCorner(Knob, 10)
            AddStroke(Knob, Color3.fromRGB(200, 200, 200), 1)
            
            table.insert(AllElements, {frame = Toggle, name = text or "Toggle", tab = name})
            
            local ToggleButton = Create("TextButton", {
                Size = UDim2.new(1, 0, 1, 0),
                BackgroundTransparency = 1,
                Text = "",
                Parent = Toggle
            })
            
            ToggleButton.MouseButton1Click:Connect(function()
                IsOn = not IsOn
                Tween(Switch, {BackgroundColor3 = IsOn and Color3.fromRGB(80, 120, 200) or Color3.fromRGB(35, 40, 50)}, 0.25)
                Tween(Knob, {Position = IsOn and UDim2.new(1, -22, 0.5, -10) or UDim2.new(0, 2, 0.5, -10)}, 0.25, Enum.EasingStyle.Back)
                Tween(ToggleStroke, {Color = IsOn and Color3.fromRGB(100, 150, 255) or Color3.fromRGB(50, 60, 80), Transparency = IsOn and 0.35 or 0.55}, 0.2)
                Tween(ToggleGlow, {ImageTransparency = IsOn and 0.78 or 0.85}, 0.25)
                callback and callback(IsOn)
            end)
            
            ToggleButton.MouseEnter:Connect(function()
                Tween(Toggle, {BackgroundColor3 = Color3.fromRGB(25, 30, 40)}, 0.15)
            end)
            
            ToggleButton.MouseLeave:Connect(function()
                Tween(Toggle, {BackgroundColor3 = Color3.fromRGB(21, 25, 33)}, 0.15)
            end)
            
            return {
                Set = function(value) IsOn = value; ToggleButton:MouseButton1Click() end,
                Get = function() return IsOn end
            }
        end
        
        function TabAPI:Slider(text, min, max, default, callback)
            local Value = default or min
            
            local Slider = Create("Frame", {
                Size = UDim2.new(1, -8, 0, 48),
                BackgroundColor3 = Color3.fromRGB(16, 19, 26),
                Parent = TabContent
            })
            AddCorner(Slider, 9)
            local SliderStroke = AddStroke(Slider, Color3.fromRGB(40, 50, 70))
            
            Create("ImageLabel", {
                Size = UDim2.new(0, 16, 0, 16),
                Position = UDim2.new(0, 12, 0, 16),
                BackgroundTransparency = 1,
                Image = Icons.Home,
                ImageColor3 = Color3.fromRGB(100, 150, 255),
                Parent = Slider
            })
            
            Create("TextLabel", {
                Size = UDim2.new(0, 90, 0, 16),
                Position = UDim2.new(0, 34, 0, 16),
                BackgroundTransparency = 1,
                Text = text or "Slider",
                TextColor3 = Color3.fromRGB(240, 245, 255),
                TextSize = 12,
                Font = Enum.Font.GothamBold,
                TextXAlignment = Enum.TextXAlignment.Left,
                Parent = Slider
            })
            
            local SliderBar = Create("Frame", {
                Size = UDim2.new(0, 140, 0, 5),
                Position = UDim2.new(1, -194, 0, 28),
                BackgroundColor3 = Color3.fromRGB(25, 30, 40),
                Parent = Slider
            })
            AddCorner(SliderBar, 2.5)
            AddStroke(SliderBar, Color3.fromRGB(50, 60, 80))
            
            local SliderFill = Create("Frame", {
                Size = UDim2.new((Value - min) / (max - min), 0, 1, 0),
                BackgroundColor3 = Color3.fromRGB(100, 150, 255),
                Parent = SliderBar
            })
            AddCorner(SliderFill, 2.5)
            
            Create("UIGradient", {
                Color = ColorSequence.new({
                    ColorSequenceKeypoint.new(0, Color3.fromRGB(100, 150, 255)),
                    ColorSequenceKeypoint.new(1, Color3.fromRGB(150, 100, 255))
                }),
                Parent = SliderFill
            })
            
            local SliderHandle = Create("Frame", {
                Size = UDim2.new(0, 14, 0, 14),
                Position = UDim2.new((Value - min) / (max - min), 0, 0.5, 0),
                AnchorPoint = Vector2.new(0.5, 0.5),
                BackgroundColor3 = Color3.fromRGB(255, 255, 255),
                Parent = SliderBar
            })
            AddCorner(SliderHandle, 7)
            
            local ValueLabel = Create("TextLabel", {
                Size = UDim2.new(0, 45, 0, 16),
                Position = UDim2.new(1, -48, 0, 16),
                BackgroundTransparency = 1,
                Text = tostring(Value),
                TextColor3 = Color3.fromRGB(100, 150, 255),
                TextSize = 12,
                Font = Enum.Font.GothamBold,
                TextXAlignment = Enum.TextXAlignment.Right,
                Parent = Slider
            })
            
            table.insert(AllElements, {frame = Slider, name = text or "Slider", tab = name})
            
            local IsDragging = false
            
            local function UpdateSlider(input)
                local barX = SliderBar.AbsolutePosition.X
                local barWidth = SliderBar.AbsoluteSize.X
                local percentage = math.clamp((input.Position.X - barX) / barWidth, 0, 1)
                Value = math.floor(min + (max - min) * percentage)
                ValueLabel.Text = tostring(Value)
                Tween(SliderFill, {Size = UDim2.new(percentage, 0, 1, 0)}, 0.1)
                Tween(SliderHandle, {Position = UDim2.new(percentage, 0, 0.5, 0)}, 0.1)
                callback and callback(Value)
            end
            
            local SliderButton = Create("TextButton", {
                Size = UDim2.new(1, 0, 0, 22),
                Position = UDim2.new(0, 0, 1, -27),
                BackgroundTransparency = 1,
                Text = "",
                Parent = Slider
            })
            
            SliderButton.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    IsDragging = true
                    UpdateSlider(input)
                    Tween(SliderHandle, {Size = UDim2.new(0, 18, 0, 18)}, 0.1)
                end
            end)
            
            UserInputService.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 and IsDragging then
                    IsDragging = false
                    Tween(SliderHandle, {Size = UDim2.new(0, 14, 0, 14)}, 0.1)
                end
            end)
            
            UserInputService.InputChanged:Connect(function(input)
                if IsDragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                    UpdateSlider(input)
                end
            end)
            
            return {
                Set = function(value)
                    Value = value
                    ValueLabel.Text = tostring(value)
                    local percentage = (value - min) / (max - min)
                    Tween(SliderFill, {Size = UDim2.new(percentage, 0, 1, 0)}, 0.2)
                    Tween(SliderHandle, {Position = UDim2.new(percentage, 0, 0.5, 0)}, 0.2)
                end,
                Get = function() return Value end
            }
        end
        
        function TabAPI:Dropdown(text, options, default, callback)
            local Selected = default or options[1] or ""
            local IsExpanded = false
            
            local Dropdown = Create("Frame", {
                Size = UDim2.new(1, -8, 0, 42),
                BackgroundColor3 = Color3.fromRGB(21, 25, 33),
                ClipsDescendants = true,
                Parent = TabContent
            })
            AddCorner(Dropdown, 8)
            local DropdownStroke = AddStroke(Dropdown, Color3.fromRGB(50, 60, 80))
            
            Create("ImageLabel", {
                Size = UDim2.new(0, 18, 0, 18),
                Position = UDim2.new(0, 12, 0, 12),
                BackgroundTransparency = 1,
                Image = Icons.Home,
                ImageColor3 = Color3.fromRGB(100, 150, 255),
                Parent = Dropdown
            })
            
            Create("TextLabel", {
                Size = UDim2.new(1, -140, 0, 42),
                Position = UDim2.new(0, 38, 0, 0),
                BackgroundTransparency = 1,
                Text = text or "Dropdown",
                TextColor3 = Color3.fromRGB(220, 230, 255),
                TextSize = 12,
                Font = Enum.Font.GothamBold,
                TextXAlignment = Enum.TextXAlignment.Left,
                Parent = Dropdown
            })
            
            local SelectedValue = Create("TextLabel", {
                Size = UDim2.new(0, 75, 0, 22),
                Position = UDim2.new(1, -85, 0, 10),
                BackgroundColor3 = Color3.fromRGB(30, 35, 45),
                Text = Selected,
                TextColor3 = Color3.fromRGB(150, 170, 220),
                TextSize = 10,
                Font = Enum.Font.Gotham,
                Parent = Dropdown
            })
            AddCorner(SelectedValue, 6)
            
            local Arrow = Create("ImageLabel", {
                Size = UDim2.new(0, 12, 0, 12),
                Position = UDim2.new(1, -26, 0, 15),
                BackgroundTransparency = 1,
                Image = Icons.Home,
                ImageColor3 = Color3.fromRGB(100, 150, 255),
                Rotation = 90,
                Parent = Dropdown
            })
            
            local OptionsContainer = Create("Frame", {
                Size = UDim2.new(1, -10, 0, 0),
                Position = UDim2.new(0, 5, 0, 44),
                BackgroundTransparency = 1,
                Parent = Dropdown
            })
            Create("UIListLayout", {Padding = UDim.new(0, 3), SortOrder = Enum.SortOrder.LayoutOrder, Parent = OptionsContainer})
            
            table.insert(AllElements, {frame = Dropdown, name = text or "Dropdown", tab = name})
            
            for _, option in ipairs(options) do
                local OptionButton = Create("TextButton", {
                    Size = UDim2.new(1, 0, 0, 28),
                    BackgroundColor3 = Color3.fromRGB(25, 30, 40),
                    Text = "",
                    AutoButtonColor = false,
                    Parent = OptionsContainer
                })
                AddCorner(OptionButton, 6)
                
                local OptionIcon = Create("ImageLabel", {
                    Size = UDim2.new(0, 12, 0, 12),
                    Position = UDim2.new(0, 10, 0.5, -6),
                    BackgroundTransparency = 1,
                    Image = Icons.Home,
                    ImageColor3 = Color3.fromRGB(100, 150, 255),
                    ImageTransparency = Selected == option and 0 or 1,
                    Parent = OptionButton
                })
                
                Create("TextLabel", {
                    Size = UDim2.new(1, -28, 1, 0),
                    Position = UDim2.new(0, 28, 0, 0),
                    BackgroundTransparency = 1,
                    Text = option,
                    TextColor3 = Color3.fromRGB(180, 190, 220),
                    TextSize = 11,
                    Font = Enum.Font.Gotham,
                    TextXAlignment = Enum.TextXAlignment.Left,
                    Parent = OptionButton
                })
                
                OptionButton.MouseButton1Click:Connect(function()
                    for _, child in pairs(OptionsContainer:GetChildren()) do
                        if child:IsA("TextButton") then
                            local icon = child:FindFirstChild("ImageLabel")
                            if icon then Tween(icon, {ImageTransparency = 1}, 0.1) end
                        end
                    end
                    Tween(OptionIcon, {ImageTransparency = 0}, 0.1)
                    Selected = option
                    SelectedValue.Text = option
                    IsExpanded = false
                    Tween(Dropdown, {Size = UDim2.new(1, -8, 0, 42)}, 0.25, Enum.EasingStyle.Back)
                    Tween(Arrow, {Rotation = 90}, 0.2)
                    callback and callback(Selected)
                end)
            end
            
            local HeaderButton = Create("TextButton", {
                Size = UDim2.new(1, 0, 0, 42),
                BackgroundTransparency = 1,
                Text = "",
                Parent = Dropdown
            })
            
            HeaderButton.MouseButton1Click:Connect(function()
                IsExpanded = not IsExpanded
                local targetHeight = IsExpanded and (44 + #options * 31) or 42
                Tween(Dropdown, {Size = UDim2.new(1, -8, 0, targetHeight)}, 0.3, Enum.EasingStyle.Back)
                Tween(Arrow, {Rotation = IsExpanded and 270 or 90}, 0.25)
                Tween(DropdownStroke, {Color = IsExpanded and Color3.fromRGB(100, 150, 255) or Color3.fromRGB(50, 60, 80)}, 0.2)
            end)
            
            return {
                Set = function(value)
                    Selected = value
                    SelectedValue.Text = value
                end,
                Get = function() return Selected end
            }
        end
        
        function TabAPI:Input(text, placeholder, callback)
            local Input = Create("Frame", {
                Size = UDim2.new(1, -8, 0, 38),
                BackgroundColor3 = Color3.fromRGB(15, 17, 23),
                Parent = TabContent
            })
            AddCorner(Input, 8)
            local InputStroke = AddStroke(Input, Color3.fromRGB(60, 80, 120))
            
            Create("ImageLabel", {
                Size = UDim2.new(0, 16, 0, 16),
                Position = UDim2.new(0, 11, 0.5, -8),
                BackgroundTransparency = 1,
                Image = Icons.Home,
                ImageColor3 = Color3.fromRGB(100, 150, 255),
                Parent = Input
            })
            
            local TextBox = Create("TextBox", {
                Size = UDim2.new(1, -38, 1, 0),
                Position = UDim2.new(0, 34, 0, 0),
                BackgroundTransparency = 1,
                Text = "",
                PlaceholderText = placeholder or "Enter text...",
                TextColor3 = Color3.fromRGB(220, 225, 255),
                PlaceholderColor3 = Color3.fromRGB(90, 100, 140),
                TextSize = 12,
                Font = Enum.Font.Gotham,
                TextXAlignment = Enum.TextXAlignment.Left,
                ClearTextOnFocus = false,
                Parent = Input
            })
            
            table.insert(AllElements, {frame = Input, name = text or "Input", tab = name})
            
            TextBox.Focused:Connect(function()
                Tween(InputStroke, {Color = Color3.fromRGB(100, 150, 255), Transparency = 0.3}, 0.25)
                Tween(Input, {BackgroundColor3 = Color3.fromRGB(20, 24, 32)}, 0.25)
            end)
            
            TextBox.FocusLost:Connect(function(enterPressed)
                Tween(InputStroke, {Color = Color3.fromRGB(60, 80, 120), Transparency = 0.55}, 0.25)
                Tween(Input, {BackgroundColor3 = Color3.fromRGB(15, 17, 23)}, 0.25)
                if enterPressed then callback and callback(TextBox.Text) end
            end)
            
            return {
                Set = function(value) TextBox.Text = value end,
                Get = function() return TextBox.Text end
            }
        end
        
        function TabAPI:Label(text)
            local Label = Create("TextLabel", {
                Size = UDim2.new(1, -8, 0, 24),
                BackgroundTransparency = 1,
                Text = text or "Label",
                TextColor3 = Color3.fromRGB(110, 125, 165),
                TextSize = 11,
                Font = Enum.Font.GothamBold,
                TextXAlignment = Enum.TextXAlignment.Left,
                Parent = TabContent
            })
            
            table.insert(AllElements, {frame = Label, name = text or "Label", tab = name})
            return Label
        end
        
        function TabAPI:Separator()
            local Separator = Create("Frame", {
                Size = UDim2.new(1, -24, 0, 1),
                BackgroundColor3 = Color3.fromRGB(40, 50, 70),
                Parent = TabContent
            })
            AddCorner(Separator, 1)
            Create("UIGradient", {
                Color = ColorSequence.new({
                    ColorSequenceKeypoint.new(0, Color3.fromRGB(40, 50, 70)),
                    ColorSequenceKeypoint.new(0.5, Color3.fromRGB(100, 150, 255)),
                    ColorSequenceKeypoint.new(1, Color3.fromRGB(40, 50, 70))
                }),
                Transparency = NumberSequence.new({
                    NumberSequenceKeypoint.new(0, 1),
                    NumberSequenceKeypoint.new(0.5, 0),
                    NumberSequenceKeypoint.new(1, 1)
                }),
                Parent = Separator
            })
            return Separator
        end
        
        return TabAPI
    end
    
    function WindowAPI:Notify(title, content, duration) return MirageUI:Notify(title, content, duration) end
    function WindowAPI:Destroy() ScreenGui:Destroy() end
    
    return WindowAPI
end

return MirageUI

